const openai = require('openai'); // Assuming you have the OpenAI library installed

// Import chatbot controller function
// const { openai } = require('../config/openaiConfig');

require('dotenv').config()
// Initialize OpenAI client
const openaiClient = new openai.OpenAIApi(process.env.OPEN_AI_KEY);

// Controller function to process chat message
const processChatMessage = async (req, res) => {
  const { message } = req.body;

  try {
    // Define the OpenAI chat completion request
    const completionRequest = {
      model: 'gpt-3.5-turbo', // The OpenAI model to use
      messages: [
        { role: 'system', content: 'You are a helpful chatbot.' },
        { role: 'user', content: message },
      ],
    };

    // Make the API request to OpenAI
    const response = await openaiClient.createChatCompletion(completionRequest);
    //const response = await openai.complete(completionRequest);

    // Extract the chatbot's reply from the response
    const chatbotReply = response.choices[0].message.content;

    // Send the chatbot reply as the API response
    res.json({ message: chatbotReply });
  } catch (error) {
    console.error(error);
    res.status(500).json({ error: 'An error occurred while processing the chat message.' });
  }
};

module.exports = { processChatMessage };
